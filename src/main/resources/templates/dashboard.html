<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>AhnLab Security Monitor</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container mt-5">
    <h2 class="mb-4">ğŸ›¡ï¸ ë³´ì•ˆ ìœ„í˜‘ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</h2>

    <div class="card mb-4">
        <div class="card-header">ê³µê²© ìœ í˜•ë³„ í˜„í™© (Real-time DB Data)</div>
        <div class="card-body" style="height: 300px">
            <canvas id="attackChart"></canvas>
        </div>
    </div>

    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <span>ìµœê·¼ íƒì§€ ë¡œê·¸ (Total: <span th:text="${logs.size()}">0</span>ê±´)</span>
            <button class="btn btn-success btn-sm">Excel Download</button>
        </div>
        <div class="card-body">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>Time</th>
                    <th>IP Address</th>
                    <th>Attack Type</th>
                    <th>Severity</th>
                    <th>Status</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="log : ${logs}">
                    <td th:text="${#dates.format(log.detectedTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
                    <td th:text="${log.ipAddress}"></td>
                    <td th:text="${log.attackType}"></td>
                    <td>
                        <span class="badge bg-danger" th:if="${log.severityLevel == 'HIGH'}" th:text="${log.severityLevel}"></span>
                        <span class="badge bg-warning text-dark" th:if="${log.severityLevel == 'MEDIUM'}" th:text="${log.severityLevel}"></span>
                        <span class="badge bg-info text-dark" th:if="${log.severityLevel == 'LOW'}" th:text="${log.severityLevel}"></span>
                    </td>
                    <td th:text="${log.status}"></td>
                </tr>
                <tr th:if="${logs.isEmpty()}">
                    <td colspan="5" class="text-center">í˜„ì¬ íƒì§€ëœ ë³´ì•ˆ ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script th:inline="javascript">
    /* Controllerì—ì„œ ë³´ë‚¸ ë¦¬ì–¼ ë°ì´í„°ë¥¼ ë°›ìŒ */
    var realLabels = [[${chartLabels}]]; // ì˜ˆ: ['SQL Injection', 'DDoS']
    var realData = [[${chartData}]];     // ì˜ˆ: [5, 3]

    const ctx = document.getElementById('attackChart').getContext('2d');
    const myChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: realLabels,
            datasets: [{
                data: realData,
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'],
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
</script>
</body>
</html>